# Musicalo üéµü§ñ

[![Version](https://img.shields.io/badge/Version-3.0.0--alpha-orange.svg)](VERSION)
[![Docker Hub](https://img.shields.io/badge/Docker%20Hub-alvaromolrui%2Fmusicalo-blue?logo=docker)](https://hub.docker.com/r/alvaromolrui/musicalo)
[![GitHub](https://img.shields.io/badge/GitHub-alvaromolrui%2Fmusicalo-black?logo=github)](https://github.com/alvaromolrui/musicalo)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Python](https://img.shields.io/badge/Python-3.11-blue?logo=python)](https://python.org)
[![Telegram](https://img.shields.io/badge/Telegram-Bot-blue?logo=telegram)](https://telegram.org)

Un bot de Telegram inteligente que utiliza IA para generar recomendaciones musicales personalizadas basadas en tu biblioteca de Navidrome y tus scrobbles de ListenBrainz o Last.fm.

## ‚ú® Caracter√≠sticas

- **ü§ñ Lenguaje Natural**: Habla directamente con el bot sin necesidad de comandos
- **üé® Peticiones Espec√≠ficas**: Describe exactamente lo que buscas con todos los detalles
- **üéØ IA Contextual**: Gemini AI entiende intenciones y responde con tus datos reales
- **üéµ Integraci√≥n con Navidrome**: Acceso completo a tu biblioteca musical autoalojada
- **üìä Scrobbles de Last.fm/ListenBrainz**: An√°lisis de tus h√°bitos de escucha y patrones
- **üß† Recomendaciones Inteligentes**: Sistema usando Google Gemini que aprende de tus gustos
- **üîÑ Variedad**: Diferentes recomendaciones cada vez
- **üì± Acceso m√≥vil**: Optimizado para usar desde tu smartphone
- **üîí Bot Privado**: Restringe el acceso solo a usuarios autorizados
- **üéµ Playlists M3U**: Generaci√≥n autom√°tica de playlists compatibles con Navidrome

### üé® Recomendaciones Ultra-Espec√≠ficas

Ahora puedes ser todo lo espec√≠fico que quieras en tus peticiones:

```
‚úÖ "Rock progresivo de los 70s con sintetizadores"
‚úÖ "M√∫sica energ√©tica con buenos solos de guitarra"
‚úÖ "Jazz suave instrumental para estudiar"
‚úÖ "Metal mel√≥dico con voces limpias"
‚úÖ "√Ålbumes conceptuales melanc√≥licos"
```

La IA entiende m√∫ltiples criterios y genera recomendaciones precisas que cumplen **todos** tus requisitos.

## üèóÔ∏è Arquitectura

### Bot de Telegram
- **üí¨ Lenguaje Natural**: Escribe directamente sin comandos (ej: "recomi√©ndame un disco de Pink Floyd")
- **üéØ Comandos tradicionales**: `/recommend`, `/library`, `/stats`, `/search` (tambi√©n funcionan)
- **üîò Botones interactivos**: Me gusta, no me gusta, m√°s recomendaciones
- **üìä Respuestas contextuales**: La IA usa tus datos reales de escucha
- **üéµ Recomendaciones variadas**: Diferentes sugerencias cada vez
- **üîÑ Modo Polling**: Conexi√≥n simple y directa con Telegram

### Backend (Python + Telegram Bot API)
- **Servicios integrados**: 
  - `NavidromeService`: Conexi√≥n con tu servidor Navidrome
  - `ListenBrainzService`: Integraci√≥n con la API de ListenBrainz (open source, sin l√≠mites)
  - `LastFMService`: Integraci√≥n con Last.fm para descubrimiento y artistas similares
  - `MusicBrainzService`: Enriquecimiento de metadatos y b√∫squeda inversa por g√©nero/pa√≠s/√©poca
  - `MusicRecommendationService`: IA con Google Gemini para recomendaciones personalizadas
  - `TelegramService`: Manejo de interacciones del bot en modo polling

**Nota sobre servicios de scrobbling:**
- Puedes usar **solo ListenBrainz**, **solo Last.fm**, o **ambos simult√°neamente**
- Si configuras ambos, ListenBrainz se usa para datos de escucha y Last.fm complementa con descubrimiento de artistas similares
- ListenBrainz es recomendado por ser open source y no tener l√≠mites de API

**Nota sobre MusicBrainz:**
- **MusicBrainz es opcional** pero **altamente recomendado** para b√∫squedas espec√≠ficas
- Permite b√∫squedas avanzadas como "indie espa√±ol de los 2000" o "rock progresivo de los 70s"
- Verifica metadatos precisos de artistas (g√©nero, pa√≠s, √©poca) contra tu biblioteca local
- Usa cache persistente para minimizar llamadas a la API
- Sistema de b√∫squeda incremental con "busca m√°s" para explorar toda tu biblioteca

## üöÄ Instalaci√≥n

### Prerrequisitos
- **Docker y Docker Compose** (recomendado) o Python 3.11+
- Servidor **Navidrome** funcionando
- Cuenta de **ListenBrainz** o **Last.fm**
- **API key de Google Gemini** (gratuita)
- **Token de bot de Telegram**

### üê≥ Opci√≥n 1: Docker (Recomendado)

```bash
# 1. Clonar repositorio
git clone https://github.com/alvaromolrui/musicalo.git
cd musicalo

# 2. Configurar credenciales
cp env.example .env
nano .env  # Editar con tus credenciales

# 3. Iniciar bot (usa imagen pre-construida de Docker Hub)
docker-compose up -d
```

**Comandos √∫tiles:**
```bash
docker-compose logs -f      # Ver logs
docker-compose restart      # Reiniciar
docker-compose down         # Detener
docker-compose pull         # Actualizar a √∫ltima versi√≥n
```

### üì¶ Opci√≥n 2: Instalaci√≥n Manual (Sin Docker)

```bash
# 1. Clonar repositorio
git clone https://github.com/alvaromolrui/musicalo.git
cd musicalo

# 2. Instalar dependencias
pip install -r requirements.txt

# 3. Configurar
cp env.example .env
nano .env
# Cambiar NAVIDROME_URL a: http://localhost:4533
# (para instalaci√≥n local sin Docker)

# 4. Ejecutar
python start-bot.py
```

## ‚öôÔ∏è Configuraci√≥n

Copia el archivo `env.example` a `.env` y configura tus credenciales:

```bash
cp env.example .env
nano .env
```

El archivo `.env` est√° completamente documentado con comentarios explicativos para cada variable.

**Variables principales:**
- `NAVIDROME_URL`: URL de tu servidor Navidrome
- `NAVIDROME_USERNAME` y `NAVIDROME_PASSWORD`: Credenciales de Navidrome
- `LISTENBRAINZ_USERNAME` y `LISTENBRAINZ_TOKEN`: Para ListenBrainz (recomendado)
- `LASTFM_API_KEY` y `LASTFM_USERNAME`: Para Last.fm (opcional, complementa a ListenBrainz)
- `GEMINI_API_KEY`: API key de Google Gemini (REQUERIDO)
- `TELEGRAM_BOT_TOKEN`: Token de tu bot de Telegram (REQUERIDO)
- `TELEGRAM_ALLOWED_USER_IDS`: IDs permitidos para bot privado (RECOMENDADO)

**Nota:** Necesitas al menos uno de los servicios de scrobbling (ListenBrainz o Last.fm) para obtener recomendaciones personalizadas.

### Obtener Credenciales

#### Bot de Telegram
1. Busca [@BotFather](https://t.me/botfather) en Telegram
2. Env√≠a `/newbot` y sigue las instrucciones
3. Elige un nombre y username para tu bot
4. Guarda el token que te proporciona

#### Obtener tu ID de Usuario (Para Bot Privado)
1. Busca [@userinfobot](https://t.me/userinfobot) en Telegram
2. Inicia conversaci√≥n y el bot te mostrar√° tu ID
3. Copia el n√∫mero de ID y agr√©galo a `TELEGRAM_ALLOWED_USER_IDS` en tu archivo `.env`
4. Puedes agregar m√∫ltiples IDs separados por comas (ej: `123456789,987654321`)

#### ListenBrainz
1. Ve a [ListenBrainz](https://listenbrainz.org/)
2. Reg√≠strate con tu cuenta de MusicBrainz
3. Opcional: Obt√©n un token de API para l√≠mites m√°s altos

#### Last.fm
1. Crea una cuenta en [Last.fm](https://www.last.fm/join)
2. Ve a [Last.fm API Account](https://www.last.fm/api/account/create)
3. Rellena el formulario:
   - **Application name**: `Musicalo Bot` (o el nombre que prefieras)
   - **Application description**: `Bot personal de Telegram para recomendaciones musicales`
   - **Application homepage**: Puedes dejar tu perfil de Last.fm o GitHub
   - **Callback URL**: D√©jalo en blanco (no se necesita)
4. Haz clic en "Submit"
5. Guarda tu **API Key** (la necesitar√°s para el archivo `.env`)
6. El **API Secret** no es necesario para este bot

#### MusicBrainz (Opcional, pero recomendado)
MusicBrainz es completamente **gratuito y open source**. No requiere API key, solo informaci√≥n de contacto:

1. **No necesitas registrarte** para usar MusicBrainz
2. Configura en tu archivo `.env`:
   - `ENABLE_MUSICBRAINZ=true` (para habilitar)
   - `APP_NAME=MusicaloBot` (nombre de tu aplicaci√≥n)
   - `CONTACT_EMAIL=tu_email@example.com` (requerido por las pol√≠ticas de MusicBrainz)
3. Configuraci√≥n opcional:
   - `MUSICBRAINZ_BATCH_SIZE=20` (artistas a verificar por b√∫squeda, 15-30 recomendado)
   - `MUSICBRAINZ_MAX_TOTAL=100` (l√≠mite m√°ximo total de artistas)

**¬øPor qu√© usar MusicBrainz?**
- ‚úÖ B√∫squedas ultra-espec√≠ficas: "indie espa√±ol de los 2000", "rock progresivo de los 70s"
- ‚úÖ Metadatos precisos de g√©nero, pa√≠s y √©poca de cada artista
- ‚úÖ Cache persistente (evita consultas repetidas)
- ‚úÖ B√∫squeda incremental con "busca m√°s"
- ‚úÖ Totalmente gratuito y sin l√≠mites estrictos

#### Google Gemini API
1. Ve a [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Crea una nueva API key
3. Es gratuita hasta 15 requests por minuto

## üîí Seguridad: Bot Privado

Por defecto, cualquier usuario de Telegram puede interactuar con tu bot. Para hacerlo **privado y seguro**, configura la variable `TELEGRAM_ALLOWED_USER_IDS` con tu ID de usuario de Telegram.

### üîê Configurar Bot Privado

**Paso 1: Obtener tu ID de Usuario**
1. Abre Telegram y busca el bot [@userinfobot](https://t.me/userinfobot)
2. Inicia conversaci√≥n con el bot
3. El bot te mostrar√° tu informaci√≥n, incluyendo tu **User ID** (un n√∫mero como `123456789`)
4. Copia ese n√∫mero

**Paso 2: Configurar IDs Permitidos**

Edita tu archivo `.env` y agrega tu ID:

```env
# Solo t√∫ puedes usar el bot
TELEGRAM_ALLOWED_USER_IDS=123456789

# O m√∫ltiples usuarios (separados por comas)
TELEGRAM_ALLOWED_USER_IDS=123456789,987654321,555444333
```

**Paso 3: Reiniciar el Bot**

```bash
# Si usas Docker
docker-compose restart

# Si lo ejecutas manualmente
python start-bot.py
```

### ‚úÖ Verificar Configuraci√≥n

Al iniciar, el bot mostrar√° en los logs:
- `üîí Bot configurado en modo privado para N usuario(s)` - ‚úÖ Est√° protegido
- `‚ö†Ô∏è Bot en modo p√∫blico` - ‚ö†Ô∏è Cualquiera puede usarlo

### üö´ ¬øQu√© pasa si alguien no autorizado intenta usar el bot?

Recibir√° un mensaje como:
```
üö´ Acceso Denegado

Este bot es privado y solo puede ser usado por usuarios autorizados.

Tu ID de usuario es: 999888777

Si crees que deber√≠as tener acceso, contacta con el administrador 
del bot y proporciona tu ID de usuario.
```

## üì± Uso del Bot

### üí¨ Lenguaje Natural

¬°Ahora puedes hablar directamente con el bot sin comandos!

**Ejemplos:**
```
"recomi√©ndame un disco de alg√∫n grupo similar a Pink Floyd"
"¬øcu√°l fue mi √∫ltima canci√≥n?"
"dame 3 artistas parecidos a Queen"
"¬øqu√© he escuchado hoy de rock?"
"busca m√∫sica de Queen en mi biblioteca"
"¬øqu√© es el jazz?" (preguntas generales sobre m√∫sica)
```

La IA entiende tu intenci√≥n y responde usando tus datos reales de Last.fm/ListenBrainz.

### üéØ Comandos Tradicionales (tambi√©n funcionan)

- **`/recommend`** - Recomendaciones musicales ‚Ä¢ Ej: /recommend rock
- **`/playlist`** - Crear playlist M3U ‚Ä¢ Ej: /playlist jazz suave
- **`/library`** - Explorar biblioteca
- **`/stats`** - Estad√≠sticas en Listenbrainz ‚Ä¢ Ej: /stats week
- **`/search`** - Buscar m√∫sica en la biblioteca ‚Ä¢ Ej: /search queen
- **`/start`** - Iniciar el bot
- **`/help`** - Mostrar ayuda completa

### Ejemplos con Comandos

```
/recommend                    # Recomendaciones generales
/recommend album rock         # √Ålbumes de rock
/recommend similar Queen      # M√∫sica similar a Queen
/library                      # Ver biblioteca
/stats                        # Ver estad√≠sticas
/search queen                 # Buscar Queen
```

### üîò Interacciones

- **Botones inline**: ‚ù§Ô∏è Me gusta, üëé No me gusta, üîÑ M√°s recomendaciones
- **Teclado personalizado**: Botones r√°pidos para comandos comunes
- **Respuestas conversacionales**: La IA responde de forma natural

## ü§ñ Comandos del Bot

### Comandos B√°sicos
- **`/start`** - Iniciar bot y mostrar bienvenida
- **`/help`** - Ayuda detallada con ejemplos

### Comandos de M√∫sica
- **`/recommend`** - Recomendaciones personalizadas con IA
- **`/library`** - Explorar biblioteca musical
- **`/stats`** - Estad√≠sticas de escucha y patrones
- **`/search <t√©rmino>`** - Buscar canciones, artistas o √°lbumes

### Interacciones
- **Botones de reacci√≥n**: ‚ù§Ô∏è Me gusta, üëé No me gusta
- **Navegaci√≥n**: üîÑ M√°s recomendaciones, üìö Ver biblioteca
- **Acciones**: üéµ Reproducir en Navidrome

## üß† Algoritmo de Recomendaciones

El sistema utiliza m√∫ltiples enfoques:

1. **An√°lisis de perfil**: Patrones de escucha, g√©neros favoritos, diversidad
2. **IA generativa**: Google Gemini para sugerencias contextuales
3. **Similitud musical**: Artistas y g√©neros relacionados
4. **Filtrado colaborativo**: Basado en usuarios con gustos similares

## üé® Tecnolog√≠as

### Backend
- **python-telegram-bot 20.7**: Framework moderno para bots
- **Google Gemini**: IA para recomendaciones contextuales
- **httpx**: Cliente HTTP as√≠ncrono para APIs
- **Pydantic**: Validaci√≥n de datos

### Bot
- **Modo Polling**: Conexi√≥n persistente con Telegram
- **Inline Keyboards**: Botones interactivos
- **Reply Keyboards**: Teclados personalizados
- **Callback Handlers**: Manejo de interacciones
- **Async/Await**: Operaciones as√≠ncronas para mejor rendimiento

## üìä Caracter√≠sticas de la IA

- **An√°lisis de g√©nero**: Identificaci√≥n autom√°tica de preferencias
- **Patrones temporales**: Horarios de escucha preferidos
- **Diversidad musical**: Medici√≥n de amplitud de gustos
- **Descubrimiento**: Sugerencias para expandir horizontes
- **Explicabilidad**: Razones claras para cada recomendaci√≥n
- **B√∫squeda inversa con MusicBrainz**: Identifica artistas de tu biblioteca que cumplen criterios espec√≠ficos (g√©nero, pa√≠s, √©poca)

## üîÆ Roadmap

- [x] **Modo conversacional**: Chat natural con la IA ‚úÖ (v1.1.0)
- [x] **Bot privado**: Control de acceso por usuario ‚úÖ (v1.1.1)
- [x] **Integraci√≥n MusicBrainz**: B√∫squedas avanzadas por g√©nero/pa√≠s/√©poca ‚úÖ (v2.0.0-alpha)
- [ ] **Notificaciones inteligentes**: Alertas basadas en patrones de escucha
- [ ] **Playlists autom√°ticas**: Creaci√≥n de playlists por IA
- [ ] **Integraci√≥n con Spotify**: Acceso a biblioteca de Spotify
- [ ] **Recomendaciones colaborativas**: Basadas en usuarios similares
- [ ] **An√°lisis de sentimientos**: Recomendaciones por estado de √°nimo
- [ ] **Estad√≠sticas avanzadas**: Gr√°ficos y an√°lisis detallados
- [ ] **Sincronizaci√≥n m√∫ltiple**: M√∫ltiples cuentas de m√∫sica

## üë®‚Äçüíª Para Desarrolladores

### üîÑ CI/CD Autom√°tico

El repositorio incluye GitHub Actions que autom√°ticamente:

- ‚úÖ **Construye la imagen** en cada push a `main`
- ‚úÖ **Sube a Docker Hub** como `alvaromolrui/musicalo:latest`
- ‚úÖ **Multiplataforma** (AMD64 y ARM64)
- ‚úÖ **Cache optimizado** para builds m√°s r√°pidos
- ‚úÖ **Tags autom√°ticos** para releases

### üì¶ Configurar GitHub Actions

Para que funcione el CI/CD autom√°tico:

1. **Ve a GitHub** ‚Üí Tu repositorio ‚Üí Settings ‚Üí Secrets
2. **A√±ade estos secrets:**
   - `DOCKER_USERNAME`: `alvaromolrui`
   - `DOCKER_PASSWORD`: Tu token de Docker Hub

3. **Obtener token de Docker Hub:**
   - Ve a [hub.docker.com](https://hub.docker.com)
   - Settings ‚Üí Security ‚Üí New Access Token
   - Copia el token y p√©galo en `DOCKER_PASSWORD`

### üè∑Ô∏è Releases y Versionado

```bash
# Crear release con tag
git tag v1.0.0
git push origin v1.0.0

# Esto autom√°ticamente crear√°:
# - alvaromolrui/musicalo:v1.0.0
# - alvaromolrui/musicalo:1.0
# - alvaromolrui/musicalo:latest (si es la rama main)
```

## ü§ù Contribuir

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver `LICENSE` para m√°s detalles.

## üôè Agradecimientos

- [Navidrome](https://github.com/navidrome/navidrome) por el excelente servidor de m√∫sica
- [ListenBrainz](https://listenbrainz.org/) por la API de scrobbling open source
- [MusicBrainz](https://musicbrainz.org/) por la base de datos de metadatos musicales open source
- [Google Gemini](https://ai.google.dev/) por las capacidades de IA
- La comunidad de desarrolladores de m√∫sica open source

## üê≥ Gesti√≥n con Docker

### Comandos Docker Compose

```bash
# Iniciar bot
docker-compose up -d

# Ver logs en tiempo real
docker-compose logs -f

# Detener bot
docker-compose down

# Actualizar a √∫ltima versi√≥n
docker-compose pull
docker-compose up -d

# Reiniciar bot
docker-compose restart
```

---

**Musicalo** - Descubre nueva m√∫sica con el poder de la IA y la simplicidad de Telegram üéµü§ñ
